{% extends "base.html" %}

{% block title %}Settings â€” Poly Copy Cat{% endblock %}

{% block content %}
<h2>Settings</h2>

{% if saved %}
<article role="alert">Settings saved. {% if was_running %}Bot restarted with new settings.{% endif %}</article>
{% endif %}

<form method="post" action="/settings">
    <article>
        <header><strong>API</strong></header>
        <label>
            API Key
            <input type="password" name="api_key" value="{{ config.api_key }}" placeholder="pcc_your_key_here">
        </label>
    </article>

    <article>
        <header><strong>Trading Mode</strong></header>
        <label>
            <input type="checkbox" name="paper_trading" value="1" role="switch"
                   {% if config.paper_trading %}checked{% endif %}>
            Paper Trading (simulated, no real money)
        </label>
    </article>

    <article>
        <header><strong>Capital & Sizing</strong></header>
        <p><small>Set your USDC balance so all trade sizes and limits scale proportionally. When set, the bot mirrors the trader's capital allocation at your scale.</small></p>
        <div class="grid">
            <label>
                Account Balance ($)
                <input type="number" name="account_balance_usd" value="{{ config.account_balance_usd|int }}" min="0" step="1" placeholder="e.g. 5000">
            </label>
            <label>
                Est. Trader Capital ($)
                <input type="number" name="trader_capital_estimate" value="{{ config.trader_capital_estimate|int }}" min="1000" step="1000">
                <small>Avg capital of traders you copy (default $100k)</small>
            </label>
        </div>
        <div class="grid">
            <label>
                Max Position (% of balance)
                <input type="number" name="max_position_pct" value="{{ (config.max_position_pct * 100)|round(1) }}" min="1" max="50" step="0.5">
                <small>Per trade cap (default 5%)</small>
            </label>
            <label>
                Daily Loss Limit (% of balance)
                <input type="number" name="daily_loss_limit_pct" value="{{ (config.daily_loss_limit_pct * 100)|round(1) }}" min="1" max="50" step="0.5">
                <small>Pause trading if hit (default 10%)</small>
            </label>
        </div>
    </article>

    <article>
        <header><strong>Risk Controls</strong></header>
        <div class="grid">
            <label>
                Max Position Size ($)
                <input type="number" name="max_position_usd" value="{{ config.max_position_usd|int }}" min="1" max="100000">
                <small>Fallback cap when account balance is not set</small>
            </label>
            <label>
                Max Concurrent Positions
                <input type="number" name="max_concurrent_positions" value="{{ config.max_concurrent_positions }}" min="1" max="100">
            </label>
        </div>
        <div class="grid">
            <label>
                Daily Loss Limit ($)
                <input type="number" name="daily_loss_limit_usd" value="{{ config.daily_loss_limit_usd|int }}" min="1" max="100000">
            </label>
            <label>
                Poll Interval (seconds)
                <input type="number" name="poll_interval" value="{{ config.poll_interval }}" min="2" max="60">
            </label>
        </div>
        <label>
            Max Traders
            <input type="number" name="max_traders" value="{{ config.max_traders }}" min="1" max="20">
        </label>
    </article>

    <details>
        <summary>Live Trading Settings (advanced)</summary>
        <article>
            <label>
                Private Key
                <input type="password" name="private_key" value="{{ config.private_key }}" placeholder="Your wallet private key">
            </label>
            <label>
                Funder Address
                <input type="text" name="funder" value="{{ config.funder }}" placeholder="Polymarket proxy wallet address">
            </label>
            <label>
                RPC URL
                <input type="text" name="rpc_url" value="{{ config.rpc_url }}">
            </label>
        </article>
    </details>

    <details>
        <summary>Auto-Claim Settings (optional)</summary>
        <article>
            <p><small>Enter your Polymarket Builder API credentials to automatically claim winnings when markets resolve. Leave blank to claim manually on polymarket.com.</small></p>
            <label>
                Builder API Key
                <input type="password" name="builder_api_key" value="{{ config.builder_api_key }}" placeholder="Builder API key">
            </label>
            <label>
                Builder API Secret
                <input type="password" name="builder_api_secret" value="{{ config.builder_api_secret }}" placeholder="Builder API secret">
            </label>
            <label>
                Builder API Passphrase
                <input type="password" name="builder_api_passphrase" value="{{ config.builder_api_passphrase }}" placeholder="Builder API passphrase">
            </label>
        </article>
    </details>

    <button type="submit">Save Settings</button>
</form>
{% endblock %}
